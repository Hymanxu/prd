<!-- 顶部导航栏 -->
<link rel="stylesheet" href="sketch-styles.css">
<nav class="sketch-bg sketch-border-light fixed w-full top-0 z-50 sketch-shadow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center h-20">
            <!-- Logo -->
            <div class="flex items-center sketch-border-light px-4 py-2">
                <div class="w-32 h-8 sketch-border-light flex items-center justify-center">
                    <span class="sketch-text text-sm font-bold">OpenHarmony</span>
                </div>
            </div>

            <!-- 主导航 - 紧靠Logo -->
            <div class="hidden md:flex items-center ml-8">
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="nav-item sketch-text font-medium text-lg py-2 px-4">首页</a>
                    <a href="contest-intro.html" class="nav-item sketch-text text-lg py-2 px-4">赛事介绍</a>
                    <a href="problems.html" class="nav-item sketch-text text-lg py-2 px-4">赛题</a>
                    <a href="leaderboard.html" class="nav-item sketch-text text-lg py-2 px-4">排行榜</a>
                    <a href="registration.html" class="nav-item sketch-text text-lg py-2 px-4">报名入口</a>
                </div>
            </div>

            <!-- 右侧空间填充 -->
            <div class="flex-1"></div>

            <!-- 用户信息/登录按钮 - 最右侧 -->
            <div class="flex items-center">
                <!-- 未登录状态 -->
                <a href="login.html"
                    class="sketch-button px-6 py-3 text-lg font-medium"
                    id="loginBtn">
                    <i class="fab fa-git-alt mr-2 sketch-icon"></i>登录
                </a>

                <!-- 已登录状态 -->
                <div class="relative hidden" id="userInfo">
                    <div class="flex items-center space-x-3 cursor-pointer sketch-border-light px-4 py-2"
                        onmouseenter="showUserMenu()" onmouseleave="hideUserMenu()">
                        <div class="w-10 h-10 sketch-border rounded-full flex items-center justify-center">
                            <i class="fas fa-user sketch-text sketch-icon"></i>
                        </div>
                        <span class="sketch-text font-medium">张三</span>
                        <i class="fas fa-chevron-down sketch-text text-sm sketch-icon"></i>
                    </div>

                    <!-- 用户菜单 -->
                    <div id="userMenu"
                        class="absolute right-0 top-full mt-2 w-40 sketch-bg sketch-border py-2 hidden z-50 sketch-shadow">
                        <button onclick="logout()"
                            class="flex items-center w-full px-4 py-3 text-sm sketch-text">
                            <i class="fas fa-sign-out-alt mr-3 sketch-icon"></i>退出登录
                        </button>
                    </div>
                </div>
            </div>

            <!-- 移动端菜单按钮 -->
            <div class="md:hidden ml-4">
                <button class="sketch-text p-2 sketch-border-light">
                    <i class="fas fa-bars text-xl sketch-icon"></i>
                </button>
            </div>
        </div>
    </div>
</nav>

<script>
    let menuTimeout;

    // 用户菜单显示/隐藏
    function showUserMenu() {
        clearTimeout(menuTimeout);
        const menu = document.getElementById('userMenu');
        if (menu) {
            menu.classList.remove('hidden');
        }
    }

    function hideUserMenu() {
        menuTimeout = setTimeout(() => {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.classList.add('hidden');
            }
        }, 300);
    }

    // 鼠标进入菜单时取消隐藏
    document.addEventListener('DOMContentLoaded', function() {
        const userMenu = document.getElementById('userMenu');
        if (userMenu) {
            userMenu.addEventListener('mouseenter', () => {
                clearTimeout(menuTimeout);
            });
            userMenu.addEventListener('mouseleave', hideUserMenu);
        }
    });

    // 退出登录
    function logout() {
        if (confirm('确定要退出登录吗？')) {
            // 清除登录状态
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userInfo');

            // 隐藏用户信息，显示登录按钮
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('loginBtn').classList.remove('hidden');
        }
    }

    // 检查登录状态
    function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

        if (isLoggedIn) {
            const loginBtn = document.getElementById('loginBtn');
            const userInfo = document.getElementById('userInfo');
            
            if (loginBtn) loginBtn.classList.add('hidden');
            if (userInfo) userInfo.classList.remove('hidden');

            // 从localStorage获取用户信息并更新显示
            const userInfoData = JSON.parse(localStorage.getItem('userInfo') || '{}');
            if (userInfoData.name) {
                const nameElement = document.querySelector('#userInfo .font-medium');
                if (nameElement) {
                    nameElement.textContent = userInfoData.name;
                }
            }
        }
    }

    // 设置当前页面的导航项为激活状态
    function setActiveNavItem() {
        const currentPage = window.location.pathname.split('/').pop() || 'index.html';
        const navItems = document.querySelectorAll('.nav-item');
        
        navItems.forEach(item => {
            const href = item.getAttribute('href');
            if (href === currentPage || (currentPage === '' && href === 'index.html')) {
                item.classList.add('active', 'text-oh-blue', 'font-medium');
                item.classList.remove('text-oh-gray');
            }
        });
    }

    // 页面加载时执行
    document.addEventListener('DOMContentLoaded', function() {
        checkLoginStatus();
        setActiveNavItem();
    });

    // 点击页面其他地方关闭菜单
    document.addEventListener('click', function(event) {
        const userInfo = document.getElementById('userInfo');
        const userMenu = document.getElementById('userMenu');
        
        if (userInfo && userMenu && !userInfo.contains(event.target)) {
            userMenu.classList.add('hidden');
        }
    });
</script>