<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机号验证 - OpenHarmony 社区创新奖励计划</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'oh-blue': '#0066CC',
                        'oh-light-blue': '#E6F3FF',
                        'oh-dark': '#1a1a1a',
                        'oh-gray': '#666666'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 min-h-screen flex items-center justify-center">
    <!-- 验证容器 -->
    <div class="max-w-md w-full mx-4">
        <!-- 验证卡片 -->
        <div class="bg-white rounded-xl shadow-xl p-8">
            <!-- Logo和标题 -->
            <div class="text-center mb-8">
                <img src="https://images.openharmony.cn/compatibility/%E6%A0%87%E8%AF%86%E4%B8%8B%E8%BD%BD/png/OpenHarmony%20logo-%E6%A8%AA%E7%89%88.png"
                    alt="OpenHarmony" class="h-12 mx-auto mb-6">
                <h1 class="text-2xl font-bold text-oh-dark mb-2">完善个人信息</h1>
                <p class="text-oh-gray">首次登录需要验证手机号并完善个人信息</p>
            </div>

            <!-- 步骤指示器 -->
            <div class="mb-8" id="stepIndicator">
                <div class="flex items-center justify-between">
                    <div class="flex items-center" id="step1">
                        <div class="bg-oh-blue text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-2">1</div>
                        <span class="text-sm font-medium text-oh-blue">手机验证</span>
                    </div>
                    <div class="h-px bg-gray-300 flex-1 mx-4" id="stepLine"></div>
                    <div class="flex items-center text-gray-400" id="step2">
                        <div class="bg-gray-300 text-gray-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-2">2</div>
                        <span class="text-sm">个人信息</span>
                    </div>
                </div>
            </div>

            <!-- 手机号验证表单 -->
            <div id="phoneStep" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-oh-dark mb-2">手机号码</label>
                    <div class="flex space-x-3">
                        <input type="tel" id="phoneInput" placeholder="请输入手机号码"
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                        <button onclick="sendVerificationCode()" id="sendCodeBtn"
                            class="bg-oh-blue text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium whitespace-nowrap">
                            发送验证码
                        </button>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-oh-dark mb-2">验证码</label>
                    <input type="text" id="codeInput" placeholder="请输入6位验证码" maxlength="6"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                </div>

                <button onclick="verifyCode()"
                    class="w-full bg-oh-blue text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    验证并继续
                </button>
            </div>

            <!-- 个人信息填写表单 -->
            <div id="infoStep" class="hidden space-y-6">
                <div>
                    <label class="block text-sm font-medium text-oh-dark mb-2">姓名</label>
                    <input type="text" id="nameInput" placeholder="请输入真实姓名"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-oh-dark mb-2">学校名称</label>
                        <input type="text" id="schoolInput" placeholder="请输入学校名称"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-oh-dark mb-2">专业</label>
                        <input type="text" id="majorInput" placeholder="请输入专业"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-oh-dark mb-2">学号</label>
                        <input type="text" id="studentIdInput" placeholder="请输入学号"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-oh-dark mb-2">邮箱</label>
                        <input type="email" id="emailInput" placeholder="请输入邮箱地址"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-oh-blue focus:border-transparent">
                    </div>
                </div>

                <div class="flex items-start">
                    <input type="checkbox" id="agreementCheck" class="mt-1 mr-3">
                    <label for="agreementCheck" class="text-sm text-gray-600">
                        我已阅读并同意 <a href="#" class="text-oh-blue hover:underline">用户协议</a> 和
                        <a href="#" class="text-oh-blue hover:underline">隐私政策</a>
                    </label>
                </div>

                <button onclick="completeRegistration()"
                    class="w-full bg-oh-blue text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                    完成注册
                </button>
            </div>
        </div>
    </div>

    <script>
        let countdown = 0;
        let countdownTimer = null;

        // 发送验证码
        function sendVerificationCode() {
            const phoneInput = document.getElementById('phoneInput');
            const phone = phoneInput.value.trim();

            if (!phone) {
                alert('请输入手机号码');
                return;
            }

            if (!/^1[3-9]\d{9}$/.test(phone)) {
                alert('请输入正确的手机号码');
                return;
            }

            const btn = document.getElementById('sendCodeBtn');
            btn.disabled = true;
            countdown = 60;

            // 模拟发送验证码
            setTimeout(() => {
                alert('验证码已发送至您的手机，请注意查收');
                startCountdown();
            }, 1000);
        }

        // 开始倒计时
        function startCountdown() {
            const btn = document.getElementById('sendCodeBtn');
            countdownTimer = setInterval(() => {
                if (countdown > 0) {
                    btn.textContent = `${countdown}s后重发`;
                    countdown--;
                } else {
                    btn.textContent = '发送验证码';
                    btn.disabled = false;
                    clearInterval(countdownTimer);
                }
            }, 1000);
        }

        // 验证验证码
        function verifyCode() {
            const phone = document.getElementById('phoneInput').value.trim();
            const code = document.getElementById('codeInput').value.trim();

            if (!phone) {
                alert('请输入手机号码');
                return;
            }

            if (!code) {
                alert('请输入验证码');
                return;
            }

            if (code.length !== 6) {
                alert('请输入6位验证码');
                return;
            }

            // 模拟验证码验证（实际项目中应该调用后端API）
            if (code === '123456' || code === '888888') {
                // 验证成功，进入下一步
                showInfoStep();
            } else {
                alert('验证码错误，请重新输入');
            }
        }

        // 显示个人信息填写步骤
        function showInfoStep() {
            document.getElementById('phoneStep').classList.add('hidden');
            document.getElementById('infoStep').classList.remove('hidden');

            // 更新步骤指示器
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const stepLine = document.getElementById('stepLine');
            
            // 第一步完成状态
            step1.innerHTML = `
                <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-2">
                    <i class="fas fa-check text-xs"></i>
                </div>
                <span class="text-sm font-medium text-green-500">手机验证</span>
            `;
            
            // 第二步激活状态
            step2.innerHTML = `
                <div class="bg-oh-blue text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-2">2</div>
                <span class="text-sm font-medium text-oh-blue">个人信息</span>
            `;
            step2.className = 'flex items-center text-oh-blue';
            
            // 连接线变为蓝色
            stepLine.className = 'h-px bg-oh-blue flex-1 mx-4';
            steps[0].classList.remove('text-oh-blue');
            steps[0].classList.add('text-green-600');
            steps[0].querySelector('div').classList.remove('bg-oh-blue');
            steps[0].querySelector('div').classList.add('bg-green-600');

            steps[1].classList.remove('text-gray-400');
            steps[1].classList.add('text-oh-blue');
            steps[1].querySelector('div').classList.remove('bg-gray-300', 'text-gray-600');
            steps[1].querySelector('div').classList.add('bg-oh-blue', 'text-white');
        }

        // 完成注册
        function completeRegistration() {
            const name = document.getElementById('nameInput').value.trim();
            const school = document.getElementById('schoolInput').value.trim();
            const major = document.getElementById('majorInput').value.trim();
            const studentId = document.getElementById('studentIdInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();
            const agreed = document.getElementById('agreementCheck').checked;

            if (!name || !school || !major || !studentId || !email) {
                alert('请填写完整的个人信息');
                return;
            }

            if (!agreed) {
                alert('请阅读并同意用户协议和隐私政策');
                return;
            }

            // 保存用户信息并完成注册
            const userInfo = {
                name: name,
                email: email,
                gitcode_id: 'zhangsan123',
                phone: document.getElementById('phoneInput').value,
                school: school,
                major: major,
                student_id: studentId,
                avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face'
            };

            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userInfo', JSON.stringify(userInfo));
            localStorage.setItem('userRegistered', 'true');
            localStorage.setItem('isRegistered', 'true'); // 添加这个标识
            localStorage.removeItem('pendingAuth');

            alert('注册完成！');
            window.location.href = 'index.html';
        }

        // 页面加载时检查是否有待处理的授权
        window.onload = function () {
            const pendingAuth = localStorage.getItem('pendingAuth');
            if (!pendingAuth) {
                // 如果没有待处理的授权，重定向到登录页
                window.location.href = 'login.html';
            }
        };
    </script>
</body>

</html>