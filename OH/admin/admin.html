<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - OpenHarmony 社区创新奖励计划</title>
    <!-- 移除 TDesign 依赖，使用自定义样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <div class="admin-layout">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-shield-alt"></i>
                    管理后台
                </div>
                <div style="font-size: 12px; color: #9CA3AF; margin-top: 4px;">
                    OpenHarmony社区创新奖励计划
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-group">
                    <div class="nav-group-title">竞赛管理</div>
                    <button class="nav-item active" data-section="events">
                        <i class="fas fa-calendar-alt"></i>
                        竞赛管理
                    </button>
                    <button class="nav-item" data-section="registrations">
                        <i class="fas fa-user-plus"></i>
                        报名管理
                    </button>
                    <button class="nav-item" data-section="settings">
                        <i class="fas fa-cog"></i>
                        网站管理
                    </button>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">赛题管理</div>
                    <button class="nav-item" data-section="problems">
                        <i class="fas fa-code"></i>
                        赛题管理
                    </button>
                    <button class="nav-item" data-section="submissions">
                        <i class="fas fa-upload"></i>
                        提交审核
                    </button>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">奖励管理</div>
                    <button class="nav-item" data-section="scoring">
                        <i class="fas fa-calculator"></i>
                        赛事结算
                    </button>
                    <button class="nav-item" data-section="certificates">
                        <i class="fas fa-certificate"></i>
                        证书发放
                    </button>
                    <button class="nav-item" data-section="templates">
                        <i class="fas fa-file-alt"></i>
                        证书模板
                    </button>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">系统管理</div>
                    <button class="nav-item" data-section="users">
                        <i class="fas fa-users"></i>
                        管理员账号
                    </button>
                </div>
            </nav>
        </aside>

        <!-- 主内容区域 -->
        <main class="main-content">
            <!-- 顶部导航 -->
            <header class="top-nav">
                <h1 class="page-title" id="pageTitle">竞赛管理</h1>
                <div class="user-menu">
                    <span>管理员</span>
                    <div class="user-avatar">A</div>
                    <button class="btn btn-outline btn-sm" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        退出
                    </button>
                </div>
            </header>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 竞赛管理 -->
                <section id="events" class="content-section active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">竞赛管理</h2>
                            <button class="btn btn-primary" onclick="openEventModal()">
                                <i class="fas fa-plus"></i>
                                新建竞赛
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>封面</th>
                                            <th>竞赛名称</th>
                                            <th>比赛时间</th>
                                            <th>状态</th>
                                            <th>参赛人数</th>
                                            <th>赛题数量</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>
                                                <div class="cover-placeholder"></div>
                                            </td>
                                            <td>OpenHarmony 2025年1月安全挑战赛</td>
                                            <td>2025-01-01 ~ 2025-01-31</td>
                                            <td><span class="status-badge status-active">已发布</span></td>
                                            <td>156</td>
                                            <td>8</td>
                                            <td>
                                                <button class="btn btn-secondary btn-sm"
                                                    onclick="unpublishEvent(1)">取消发布</button>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="editEvent(1)">编辑</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>
                                                <div class="cover-placeholder"></div>
                                            </td>
                                            <td>OpenHarmony 2025年2月安全挑战赛</td>
                                            <td>2025-02-01 ~ 2025-02-28</td>
                                            <td><span class="status-badge status-draft">新建</span></td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>
                                                <button class="btn btn-success btn-sm"
                                                    onclick="publishEvent(2)">发布</button>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="editEvent(2)">编辑</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 报名管理 -->
                <section id="registrations" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">报名管理</h2>
                            <button class="btn btn-secondary" onclick="exportRegistrations()">
                                <i class="fas fa-download"></i>
                                导出
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="toolbar">
                                <div class="toolbar-left">
                                    <select class="form-control" onchange="filterRegistrationsByEvent(this.value)">
                                        <option value="">选择赛事</option>
                                        <option value="1">2025年1月安全挑战赛</option>
                                        <option value="2">2025年2月安全挑战赛</option>
                                    </select>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>用户名</th>
                                            <th>学校</th>
                                            <th>专业</th>
                                            <th>邮箱</th>
                                            <th>报名时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>张三</td>
                                            <td>清华大学</td>
                                            <td>计算机科学与技术</td>
                                            <td>zhangsan@example.com</td>
                                            <td>2025-01-15 14:30</td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="viewRegistrationDetail(1)">查看</button>
                                                <button class="btn btn-danger btn-sm"
                                                    onclick="removeRegistration(1)">移除</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 网站管理 -->
                <section id="settings" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">网站管理</h2>
                        </div>
                        <div class="card-body">
                            <div class="config-tabs">
                                <button class="config-tab active" onclick="switchConfigTab('banner')">首页banner</button>
                                <button class="config-tab" onclick="switchConfigTab('introduction')">大赛介绍</button>
                                <button class="config-tab" onclick="switchConfigTab('notices')">通知公告</button>
                                <button class="config-tab" onclick="switchConfigTab('faq')">常见问题</button>
                            </div>

                            <!-- 首页banner -->
                            <div id="banner-config" class="config-content active">
                                <div class="banner-management">
                                    <div class="banner-list" id="bannerList">
                                        <!-- 已上传的banner会在这里显示 -->
                                    </div>
                                    <div class="upload-banner-card">
                                        <div class="upload-placeholder" onclick="addBannerImage()">
                                            <i class="fas fa-plus"></i>
                                            <p>上传Banner</p>
                                            <small>支持png、jpg图片上传<br>尺寸要求：1920*630</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 大赛介绍 -->
                            <div id="introduction-config" class="config-content">
                                <div class="form-group">
                                    <label class="form-label">大赛介绍内容</label>
                                    <div class="rich-editor">
                                        <div class="editor-toolbar">
                                            <button type="button" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                                            <button type="button" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                                            <button type="button" onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                                            <button type="button" onclick="insertLink()"><i class="fas fa-link"></i></button>
                                            <button type="button" onclick="insertImage()"><i class="fas fa-image"></i></button>
                                        </div>
                                        <div class="editor-content" id="introductionEditor" contenteditable="true" placeholder="输入大赛介绍内容..."></div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-secondary" onclick="clearIntroduction()">
                                        <i class="fas fa-trash"></i> 清空
                                    </button>
                                    <button class="btn btn-primary" onclick="saveIntroduction()">保存</button>
                                </div>
                            </div>

                            <!-- 通知公告 -->
                            <div id="notices-config" class="config-content">
                                <div class="toolbar">
                                    <button class="btn btn-primary" onclick="addNotice()">
                                        <i class="fas fa-plus"></i>
                                        新建公告
                                    </button>
                                </div>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>标题</th>
                                                <th>发布时间</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2025年1月赛事开始报名</td>
                                                <td>2025-01-01 10:00</td>
                                                <td><span class="status-badge status-active">已发布</span></td>
                                                <td>
                                                    <button class="btn btn-outline btn-sm"
                                                        onclick="editNotice(1)">编辑</button>
                                                    <button class="btn btn-secondary btn-sm"
                                                        onclick="unpublishNotice(1)">取消发布</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- 常见问题 -->
                            <div id="faq-config" class="config-content">
                                <div class="toolbar">
                                    <button class="btn btn-primary" onclick="addFAQ()">
                                        <i class="fas fa-plus"></i>
                                        新建问题
                                    </button>
                                </div>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>问题</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>如何参与竞赛？</td>
                                                <td><span class="status-badge status-active">显示</span></td>
                                                <td>
                                                    <button class="btn btn-outline btn-sm"
                                                        onclick="editFAQ(1)">编辑</button>
                                                    <button class="btn btn-secondary btn-sm"
                                                        onclick="hideFAQ(1)">隐藏</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 赛题管理 -->
                <section id="problems" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">赛题管理</h2>
                            <div>
                                <button class="btn btn-secondary" onclick="batchImportProblems()">
                                    <i class="fas fa-upload"></i>
                                    批量导入
                                </button>
                                <button class="btn btn-primary" onclick="openProblemModal()">
                                    <i class="fas fa-plus"></i>
                                    创建赛题
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="toolbar">
                                <div class="toolbar-left">
                                    <select class="form-control" onchange="filterProblemsByEvent(this.value)">
                                        <option value="">选择赛事</option>
                                        <option value="1">2025年1月安全挑战赛</option>
                                        <option value="2">2025年2月安全挑战赛</option>
                                    </select>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>赛题名称</th>
                                            <th>所属竞赛</th>
                                            <th>难度</th>
                                            <th>issue链接</th>
                                            <th>标签</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>OpenHarmony内核缓冲区溢出检测</td>
                                            <td>2025年1月安全挑战赛</td>
                                            <td><span class="status-badge status-pending">中等</span></td>
                                            <td><a href="https://github.com/example/issue/123" target="_blank">#123</a>
                                            </td>
                                            <td>
                                                <span class="status-badge">内核</span>
                                                <span class="status-badge">缓冲区溢出</span>
                                            </td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="editProblem(1)">编辑</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 提交审核 -->
                <section id="submissions" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">提交审核</h2>
                            <div>
                                <button class="btn btn-success" onclick="batchApproveSubmissions()">
                                    <i class="fas fa-check"></i>
                                    批量通过
                                </button>
                                <button class="btn btn-danger" onclick="batchRejectSubmissions()">
                                    <i class="fas fa-times"></i>
                                    批量拒绝
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="toolbar">
                                <div class="toolbar-left">
                                    <select class="form-control" onchange="filterSubmissionsByEvent(this.value)">
                                        <option value="">选择竞赛</option>
                                        <option value="1">2025年1月安全挑战赛</option>
                                        <option value="2">2025年2月安全挑战赛</option>
                                    </select>
                                    <select class="form-control" onchange="filterSubmissionsByProblem(this.value)">
                                        <option value="">选择赛题</option>
                                        <option value="1">内核缓冲区溢出检测</option>
                                        <option value="2">权限提升漏洞分析</option>
                                    </select>
                                </div>
                                <div class="toolbar-right">
                                    <select class="form-control" onchange="filterSubmissionsByStatus(this.value)">
                                        <option value="">全部状态</option>
                                        <option value="pending">待审核</option>
                                        <option value="approved">已通过</option>
                                        <option value="rejected">已拒绝</option>
                                    </select>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" onchange="toggleAllSubmissions(this.checked)">
                                            </th>
                                            <th>commit ID</th>
                                            <th>用户名</th>
                                            <th>赛题</th>
                                            <th>提交时间</th>
                                            <th>类型</th>
                                            <th>积分</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><input type="checkbox"
                                                    onchange="toggleSubmissionSelection(1, this.checked)"></td>
                                            <td><code>a7b3c9</code></td>
                                            <td>张三</td>
                                            <td>内核缓冲区溢出检测</td>
                                            <td>2025-01-15 14:30</td>
                                            <td><span class="status-badge">覆盖率提升</span></td>
                                            <td>85</td>
                                            <td><span class="status-badge status-pending">待审核</span></td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="viewSubmissionDetail(1)">查看</button>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="reviewSubmission(1)">审核</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 赛事结算 -->
                <section id="scoring" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">赛事结算</h2>
                            <button class="btn btn-secondary" onclick="exportScoring()">
                                <i class="fas fa-download"></i>
                                导出结算数据
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="toolbar">
                                <div class="toolbar-left">
                                    <select class="form-control" onchange="filterScoringByEvent(this.value)">
                                        <option value="">选择竞赛</option>
                                        <option value="1">2025年1月安全挑战赛</option>
                                        <option value="2">2025年2月安全挑战赛</option>
                                    </select>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>排名</th>
                                            <th>用户名</th>
                                            <th>学校</th>
                                            <th>积分</th>
                                            <th>收款信息</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>张三</td>
                                            <td>清华大学</td>
                                            <td>1,250</td>
                                            <td><span class="status-badge status-active">已完善</span></td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="viewScoreDetail(1)">查看</button>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="adjustScore(1)">调整</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 证书发放 -->
                <section id="certificates" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">证书发放</h2>
                            <button class="btn btn-primary" onclick="openCertificateRuleModal()">
                                <i class="fas fa-plus"></i>
                                新建发放
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>竞赛</th>
                                            <th>发放条件</th>
                                            <th>证书模板</th>
                                            <th>发放时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025年1月安全挑战赛</td>
                                            <td>前10名</td>
                                            <td>优秀奖证书</td>
                                            <td>2025-02-01 10:00</td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="editCertificateRule(1)">编辑</button>
                                                <button class="btn btn-danger btn-sm"
                                                    onclick="deleteCertificateRule(1)">删除</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 证书模板 -->
                <section id="templates" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">证书模板</h2>
                            <button class="btn btn-primary" onclick="openTemplateModal()">
                                <i class="fas fa-plus"></i>
                                创建模板
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="template-grid">
                                <div class="template-card">
                                    <div class="template-preview">
                                        <div class="template-placeholder">证书模板占位</div>
                                    </div>
                                    <div class="template-info">
                                        <h4>优秀奖证书</h4>
                                        <div class="template-actions">
                                            <button class="btn btn-outline btn-sm"
                                                onclick="previewTemplate(1)">预览</button>
                                            <button class="btn btn-outline btn-sm"
                                                onclick="editCertificateTemplate(1)">编辑</button>
                                            <button class="btn btn-danger btn-sm"
                                                onclick="deleteCertificateTemplate(1)">删除</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 管理员账号 -->
                <section id="users" class="content-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">管理员账号</h2>
                            <button class="btn btn-primary" onclick="openAddAdminModal()">
                                <i class="fas fa-plus"></i>
                                创建账号
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>姓名</th>
                                            <th>手机号</th>
                                            <th>权限</th>
                                            <th>状态</th>
                                            <th>创建时间</th>
                                            <th>最后登录时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>管理员</td>
                                            <td>138****8888</td>
                                            <td>
                                                <span class="status-badge">竞赛管理</span>
                                                <span class="status-badge">赛题管理</span>
                                                <span class="status-badge">奖励管理</span>
                                                <span class="status-badge">系统管理</span>
                                            </td>
                                            <td><span class="status-badge status-active">启用</span></td>
                                            <td>2025-01-01 10:00</td>
                                            <td>2025-01-15 14:30</td>
                                            <td>
                                                <button class="btn btn-outline btn-sm"
                                                    onclick="editAdmin(1)">编辑</button>
                                                <button class="btn btn-secondary btn-sm"
                                                    onclick="disableAdmin(1)">禁用</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    <!-- 弹窗模态框 -->

    <!-- 新建/编辑竞赛弹窗 -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新建竞赛</h3>
                <button class="modal-close" onclick="closeEventModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">封面上传</label>
                    <input type="file" class="form-control" accept="image/png" onchange="previewCover(this)">
                    <small class="form-text">建议尺寸：640*360，格式：png</small>
                    <div id="coverPreview" class="cover-preview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">竞赛名称</label>
                    <input type="text" class="form-control" placeholder="请输入竞赛名称">
                </div>
                <div class="form-group">
                    <label class="form-label">比赛时间</label>
                    <div class="date-range">
                        <input type="datetime-local" class="form-control">
                        <span>至</span>
                        <input type="datetime-local" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">主题</label>
                    <textarea class="form-control" rows="3" placeholder="请输入竞赛主题"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeEventModal()">取消</button>
                <button class="btn btn-primary" onclick="saveEvent()">保存</button>
            </div>
        </div>
    </div>

    <!-- 报名详情弹窗 -->
    <div id="registrationDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">报名详情</h3>
                <button class="modal-close" onclick="closeRegistrationDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>用户名：</label>
                        <span>张三</span>
                    </div>
                    <div class="detail-item">
                        <label>学校：</label>
                        <span>清华大学</span>
                    </div>
                    <div class="detail-item">
                        <label>专业：</label>
                        <span>计算机科学与技术</span>
                    </div>
                    <div class="detail-item">
                        <label>邮箱：</label>
                        <span>zhangsan@example.com</span>
                    </div>
                    <div class="detail-item">
                        <label>手机号：</label>
                        <span>138****8888</span>
                    </div>
                    <div class="detail-item">
                        <label>报名时间：</label>
                        <span>2025-01-15 14:30</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeRegistrationDetailModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 创建赛题弹窗 -->
    <div id="problemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">创建赛题</h3>
                <button class="modal-close" onclick="closeProblemModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">赛题名称</label>
                    <input type="text" class="form-control" placeholder="请输入赛题名称">
                </div>
                <div class="form-group">
                    <label class="form-label">难度</label>
                    <select class="form-control">
                        <option value="">选择难度</option>
                        <option value="easy">简单</option>
                        <option value="medium">中等</option>
                        <option value="hard">困难</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Issue链接</label>
                    <input type="url" class="form-control" placeholder="https://github.com/...">
                </div>
                <div class="form-group">
                    <label class="form-label">详细介绍</label>
                    <div class="rich-editor">
                        <div class="editor-toolbar">
                            <button type="button" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                            <button type="button" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                            <button type="button" onclick="formatText('underline')"><i
                                    class="fas fa-underline"></i></button>
                            <button type="button" onclick="insertLink()"><i class="fas fa-link"></i></button>
                            <button type="button" onclick="insertImage()"><i class="fas fa-image"></i></button>
                        </div>
                        <div class="editor-content" contenteditable="true" placeholder="请输入详细介绍..."></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">标签</label>
                    <input type="text" class="form-control" placeholder="输入标签，用逗号分隔">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeProblemModal()">取消</button>
                <button class="btn btn-primary" onclick="saveProblem()">保存</button>
            </div>
        </div>
    </div>

    <!-- 批量导入赛题弹窗 -->
    <div id="batchImportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">批量导入赛题</h3>
                <button class="modal-close" onclick="closeBatchImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">选择文件</label>
                    <input type="file" class="form-control" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(this)">
                    <small class="form-text">支持Excel和CSV格式</small>
                </div>
                <div class="form-group">
                    <button class="btn btn-outline" onclick="downloadTemplate()">
                        <i class="fas fa-download"></i>
                        下载模板
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeBatchImportModal()">取消</button>
                <button class="btn btn-primary">导入</button>
            </div>
        </div>
    </div>

    <!-- 提交详情查看弹窗 -->
    <div id="submissionDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">提交详情</h3>
                <button class="modal-close" onclick="closeSubmissionDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Commit ID：</label>
                        <span id="detailCommitId">a7b3c9</span>
                    </div>
                    <div class="detail-item">
                        <label>用户名：</label>
                        <span id="detailUsername">张三</span>
                    </div>
                    <div class="detail-item">
                        <label>赛题：</label>
                        <span id="detailProblem">内核缓冲区溢出检测</span>
                    </div>
                    <div class="detail-item">
                        <label>提交时间：</label>
                        <span id="detailSubmitTime">2025-01-15 14:30</span>
                    </div>
                    <div class="detail-item">
                        <label>类型：</label>
                        <span id="detailType">覆盖率提升</span>
                    </div>
                    <div class="detail-item">
                        <label>积分：</label>
                        <span id="detailScore">85</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">提交说明</label>
                    <div class="detail-content" id="detailDescription">
                        这是提交的详细说明内容...
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">代码链接</label>
                    <div class="detail-content">
                        <a href="#" target="_blank" id="detailCodeLink">查看代码</a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeSubmissionDetailModal()">关闭</button>
                <button class="btn btn-primary" onclick="reviewSubmissionFromDetail()">审核</button>
            </div>
        </div>
    </div>

    <!-- 提交审核弹窗 -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">提交审核</h3>
                <button class="modal-close" onclick="closeReviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="review-info">
                    <div class="info-item">
                        <label>提交ID：</label>
                        <span>a7b3c9</span>
                    </div>
                    <div class="info-item">
                        <label>用户：</label>
                        <span>张三</span>
                    </div>
                    <div class="info-item">
                        <label>赛题：</label>
                        <span>内核缓冲区溢出检测</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">审核结果</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="reviewResult" value="approved"
                                onchange="toggleReviewResult('approved')">
                            <span>通过</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="reviewResult" value="rejected"
                                onchange="toggleReviewResult('rejected')">
                            <span>拒绝</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">积分</label>
                    <input type="number" class="form-control" placeholder="请输入积分">
                </div>
                <div class="form-group">
                    <label class="form-label">审核意见</label>
                    <textarea class="form-control" rows="4" placeholder="请输入审核意见..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeReviewModal()">取消</button>
                <button class="btn btn-primary" onclick="submitReview()">提交审核</button>
            </div>
        </div>
    </div>

    <!-- 编辑证书发放弹窗 -->
    <div id="editCertificateRuleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">编辑发放规则</h3>
                <button class="modal-close" onclick="closeEditCertificateRuleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">竞赛名称</label>
                    <input type="text" class="form-control" id="editRuleEventName" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">发放条件</label>
                    <div class="condition-tabs">
                        <button type="button" class="condition-tab active" onclick="toggleEditConditionInput('rank')">按排名</button>
                        <button type="button" class="condition-tab" onclick="toggleEditConditionInput('score')">按积分</button>
                        <button type="button" class="condition-tab" onclick="toggleEditConditionInput('submission')">按提交次数</button>
                    </div>
                    <div id="editRankCondition" class="condition-input active">
                        <input type="number" class="form-control" id="editRankValue" placeholder="前N名">
                    </div>
                    <div id="editScoreCondition" class="condition-input">
                        <input type="number" class="form-control" id="editScoreValue" placeholder="积分大于等于">
                    </div>
                    <div id="editSubmissionCondition" class="condition-input">
                        <input type="number" class="form-control" id="editSubmissionValue" placeholder="提交次数大于等于">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">证书模板</label>
                    <select class="form-control" id="editRuleTemplate">
                        <option value="">请选择模板</option>
                        <option value="1">优秀奖证书</option>
                        <option value="2">参与奖证书</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeEditCertificateRuleModal()">取消</button>
                <button class="btn btn-primary" onclick="saveEditCertificateRule()">保存</button>
            </div>
        </div>
    </div>

    <!-- 新建证书发放弹窗 -->
    <div id="certificateRuleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新建发放</h3>
                <button class="modal-close" onclick="closeCertificateRuleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">选择竞赛</label>
                    <select class="form-control">
                        <option value="">请选择竞赛</option>
                        <option value="1">2025年1月安全挑战赛</option>
                        <option value="2">2025年2月安全挑战赛</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">发放条件</label>
                    <div class="condition-tabs">
                        <button type="button" class="condition-tab active"
                            onclick="toggleConditionInput('rank')">按排名</button>
                        <button type="button" class="condition-tab" onclick="toggleConditionInput('score')">按积分</button>
                        <button type="button" class="condition-tab"
                            onclick="toggleConditionInput('submission')">按提交次数</button>
                    </div>
                    <div id="rankCondition" class="condition-input active">
                        <input type="number" class="form-control" placeholder="前N名">
                    </div>
                    <div id="scoreCondition" class="condition-input">
                        <input type="number" class="form-control" placeholder="积分大于等于">
                    </div>
                    <div id="submissionCondition" class="condition-input">
                        <input type="number" class="form-control" placeholder="提交次数大于等于">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">选择证书模板</label>
                    <select class="form-control">
                        <option value="">请选择模板</option>
                        <option value="1">优秀奖证书</option>
                        <option value="2">参与奖证书</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeCertificateRuleModal()">取消</button>
                <button class="btn btn-primary" onclick="saveCertificateRule()">保存</button>
            </div>
        </div>
    </div>

    <!-- 证书模板预览弹窗 -->
    <div id="templatePreviewModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">证书模板预览</h3>
                <button class="modal-close" onclick="closeTemplatePreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="template-preview-container">
                    <div class="certificate-canvas" id="previewCanvas">
                        <div class="certificate-placeholder">证书预览区域</div>
                        <!-- 动态生成的字段预览 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeTemplatePreviewModal()">关闭</button>
                <button class="btn btn-primary" onclick="editTemplateFromPreview()">编辑模板</button>
            </div>
        </div>
    </div>

    <!-- 证书模板编辑弹窗 -->
    <div id="templateEditModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">编辑证书模板</h3>
                <button class="modal-close" onclick="closeTemplateEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="template-editor">
                    <div class="editor-toolbar">
                        <button class="btn btn-outline btn-sm" onclick="previewTemplateDesign()">
                            <i class="fas fa-eye"></i> 预览
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="resetTemplateFields()">
                            <i class="fas fa-undo"></i> 重置
                        </button>
                    </div>
                    <div class="template-designer">
                        <div class="template-canvas" id="editCanvas" ondrop="dropField(event)" ondragover="allowDrop(event)">
                            <div class="certificate-background" id="certificateBackground">
                                <div class="certificate-placeholder">上传证书背景图片</div>
                            </div>
                            <!-- 可拖拽的字段会在这里显示 -->
                        </div>
                        <div class="field-palette">
                            <h4>可用字段</h4>
                            <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="eventName">
                                <i class="fas fa-trophy"></i> 竞赛名称
                            </div>
                            <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="theme">
                                <i class="fas fa-tag"></i> 主题
                            </div>
                            <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="time">
                                <i class="fas fa-calendar"></i> 时间
                            </div>
                            <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="username">
                                <i class="fas fa-user"></i> 用户名
                            </div>
                            <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="award">
                                <i class="fas fa-medal"></i> 奖项
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeTemplateEditModal()">取消</button>
                <button class="btn btn-secondary" onclick="previewTemplateDesign()">预览</button>
                <button class="btn btn-primary" onclick="saveTemplateDesign()">保存</button>
            </div>
        </div>
    </div>

    <!-- 创建证书模板弹窗 -->
    <div id="templateModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">创建证书模板</h3>
                <button class="modal-close" onclick="closeTemplateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">模板名称</label>
                    <input type="text" class="form-control" id="templateName" placeholder="请输入模板名称">
                </div>
                <div class="form-group">
                    <label class="form-label">证书图片</label>
                    <input type="file" class="form-control" accept="image/*" onchange="previewCertificateImage(this)">
                    <small class="form-text">上传证书背景图片</small>
                </div>
                <div class="template-designer">
                    <div class="template-canvas" id="createCanvas" ondrop="dropField(event)" ondragover="allowDrop(event)">
                        <div class="certificate-background" id="createCertificateBackground">
                            <div class="certificate-placeholder">上传证书背景图片后，拖拽字段到此处</div>
                        </div>
                        <!-- 可拖拽的字段会在这里显示 -->
                    </div>
                    <div class="field-palette">
                        <h4>可用字段</h4>
                        <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="eventName">
                            <i class="fas fa-trophy"></i> 竞赛名称
                        </div>
                        <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="theme">
                            <i class="fas fa-tag"></i> 主题
                        </div>
                        <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="time">
                            <i class="fas fa-calendar"></i> 时间
                        </div>
                        <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="username">
                            <i class="fas fa-user"></i> 用户名
                        </div>
                        <div class="field-item" draggable="true" ondragstart="dragField(event)" data-field="award">
                            <i class="fas fa-medal"></i> 奖项
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeTemplateModal()">取消</button>
                <button class="btn btn-secondary" onclick="previewTemplateFromCreate()">预览</button>
                <button class="btn btn-primary" onclick="saveTemplate()">保存</button>
            </div>
        </div>
    </div>

    <!-- 积分详情查看弹窗 -->
    <div id="scoreDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">积分详情</h3>
                <button class="modal-close" onclick="closeScoreDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>用户名：</label>
                        <span id="scoreDetailUsername">张三</span>
                    </div>
                    <div class="detail-item">
                        <label>学校：</label>
                        <span id="scoreDetailSchool">清华大学</span>
                    </div>
                    <div class="detail-item">
                        <label>排名：</label>
                        <span id="scoreDetailRank">1</span>
                    </div>
                    <div class="detail-item">
                        <label>总积分：</label>
                        <span id="scoreDetailTotal">1,250</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 24px;">
                    <label class="form-label">积分明细</label>
                    <div class="score-breakdown">
                        <div class="score-item">
                            <span>覆盖率提升</span>
                            <span>+85分</span>
                        </div>
                        <div class="score-item">
                            <span>漏洞发现</span>
                            <span>+150分</span>
                        </div>
                        <div class="score-item">
                            <span>代码质量</span>
                            <span>+65分</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeScoreDetailModal()">关闭</button>
                <button class="btn btn-primary" onclick="openScoreAdjustModal()">调整积分</button>
            </div>
        </div>
    </div>

    <!-- 积分调整弹窗 -->
    <div id="scoreAdjustModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">调整积分</h3>
                <button class="modal-close" onclick="closeScoreAdjustModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" class="form-control" id="adjustUsername" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">新积分</label>
                    <input type="number" class="form-control" id="newScore" placeholder="请输入新的积分值">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeScoreAdjustModal()">取消</button>
                <button class="btn btn-primary" onclick="submitScoreAdjust()">确认调整</button>
            </div>
        </div>
    </div>

    <!-- 创建/编辑管理员弹窗 -->
    <div id="addAdminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">创建管理员账号</h3>
                <button class="modal-close" onclick="closeAddAdminModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">姓名</label>
                    <input type="text" class="form-control" id="adminName" placeholder="请输入姓名">
                </div>
                <div class="form-group">
                    <label class="form-label">手机号</label>
                    <input type="tel" class="form-control" id="adminPhone" placeholder="请输入手机号">
                </div>
                <div class="form-group">
                    <label class="form-label">权限设置</label>
                    <div class="permission-group">
                        <label class="checkbox-item">
                            <input type="checkbox" value="contest" id="permContest">
                            <span>竞赛管理</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="problem" id="permProblem">
                            <span>赛题管理</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="reward" id="permReward">
                            <span>奖励管理</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" value="system" id="permSystem">
                            <span>系统管理</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeAddAdminModal()">取消</button>
                <button class="btn btn-primary" onclick="saveAdmin()">保存</button>
            </div>
        </div>
    </div>

    <!-- 新建/编辑通知公告弹窗 -->
    <div id="noticeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新建公告</h3>
                <button class="modal-close" onclick="closeNoticeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">公告标题</label>
                    <input type="text" class="form-control" id="noticeTitle" placeholder="请输入公告标题">
                </div>
                <div class="form-group">
                    <label class="form-label">公告内容</label>
                    <div class="rich-editor">
                        <div class="editor-toolbar">
                            <button type="button" onclick="formatNoticeText('bold')"><i class="fas fa-bold"></i></button>
                            <button type="button" onclick="formatNoticeText('italic')"><i class="fas fa-italic"></i></button>
                            <button type="button" onclick="formatNoticeText('underline')"><i class="fas fa-underline"></i></button>
                            <button type="button" onclick="insertNoticeLink()"><i class="fas fa-link"></i></button>
                            <button type="button" onclick="insertNoticeImage()"><i class="fas fa-image"></i></button>
                        </div>
                        <div class="editor-content" id="noticeContentEditor" contenteditable="true" placeholder="请输入公告内容..."></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeNoticeModal()">取消</button>
                <button class="btn btn-primary" onclick="publishNotice()">发布</button>
            </div>
        </div>
    </div>

    <!-- 新建/编辑FAQ弹窗 -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新建问题</h3>
                <button class="modal-close" onclick="closeFAQModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">问题</label>
                    <input type="text" class="form-control" id="faqQuestion" placeholder="请输入问题">
                </div>
                <div class="form-group">
                    <label class="form-label">答案</label>
                    <div class="rich-editor">
                        <div class="editor-toolbar">
                            <button type="button" onclick="formatFAQText('bold')"><i class="fas fa-bold"></i></button>
                            <button type="button" onclick="formatFAQText('italic')"><i class="fas fa-italic"></i></button>
                            <button type="button" onclick="formatFAQText('underline')"><i class="fas fa-underline"></i></button>
                            <button type="button" onclick="insertFAQLink()"><i class="fas fa-link"></i></button>
                            <button type="button" onclick="insertFAQImage()"><i class="fas fa-image"></i></button>
                        </div>
                        <div class="editor-content" id="faqAnswerEditor" contenteditable="true" placeholder="请输入答案..."></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeFAQModal()">取消</button>
                <button class="btn btn-primary" onclick="publishFAQ()">发布</button>
            </div>
        </div>
    </div>

    <!-- 上传Banner弹窗 -->
    <div id="bannerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">上传Banner</h3>
                <button class="modal-close" onclick="closeBannerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Banner图片</label>
                    <input type="file" class="form-control" accept="image/png" onchange="previewBannerImage(this)">
                    <small class="form-text">建议尺寸：1920*630，格式：png</small>
                    <div id="bannerPreview" class="banner-preview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">链接地址</label>
                    <input type="url" class="form-control" placeholder="点击Banner跳转的链接（可选）">
                </div>
                <div class="form-group">
                    <label class="checkbox-item">
                        <input type="checkbox" checked>
                        <span>立即启用</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeBannerModal()">取消</button>
                <button class="btn btn-primary" onclick="saveBanner()">保存</button>
            </div>
        </div>
    </div>

    <!-- 脚本引入 -->
    <!-- 移除 TDesign JS 依赖 -->
    <script src="js/template-loader.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/events.js"></script>
    <script src="js/problems.js"></script>
    <script src="js/submissions.js"></script>
    <script src="js/certificates.js"></script>
    <script src="js/users.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/global-functions.js"></script>
    <script src="js/main.js"></script>
</body>

</html>